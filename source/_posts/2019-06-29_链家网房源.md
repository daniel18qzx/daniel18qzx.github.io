
---
title: 链家网房源
date: 2019-06-29
id: 1
categories: [爬虫, 项目]
---


```python
import requests
import time
from bs4 import BeautifulSoup
```


```python
#设置列表页URL的固定部分
url='http://bj.lianjia.com/ershoufang/'
#设置页面页的可变部分
page=('pg')
```


```python
#设置请求头部信息
headers = {'User-Agent':'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11',
'Accept':'text/html;q=0.9,*/*;q=0.8',
'Accept-Charset':'ISO-8859-1,utf-8;q=0.7,*;q=0.3',
'Accept-Encoding':'gzip',
'Connection':'close',
'Referer':'http://www.baidu.com/link?url=_andhfsjjjKRgEWkj7i9cFmYYGsisrnm2A-TN3XZDQXxvGsM9k9ZZSnikW2Yds4s&amp;amp;wd=&amp;amp;eqid=c3435a7d00146bd600000003582bfd1f'
}
```


```python
#循环抓取列表页信息
for i in range(1,2):
     if i == 1:
          i=str(i)
          a=(url+page+i+'/')
          r=requests.get(url=a,headers=headers)
          html=r.content
     else:
          i=str(i)
          a=(url+page+i+'/')
          r=requests.get(url=a,headers=headers)
          html2=r.content
          html = html + html2
     #每次间隔1秒
     time.sleep(1)
```


```python
#解析抓取的页面内容
lj=BeautifulSoup(html,'html.parser')
```


```python
#提取房源总价
price=lj.find_all('div','priceInfo')
tp=[]
for a in price:
    totalPrice=a.span.string
    tp.append(totalPrice)
```


```python
#提取房源信息
houseInfo=lj.find_all('div',attrs={'class':'houseInfo'})
 
hi=[]
for b in houseInfo:
    house=b.get_text()
    hi.append(house)
```


```python
#提取房源关注度
followInfo=lj.find_all('div',attrs={'class':'followInfo'})
 
fi=[]
for c in followInfo:
    follow=c.get_text()
    fi.append(follow)
```


```python
#导入pandas库
import pandas as pd
#创建数据表
house=pd.DataFrame({'totalprice':tp,'houseinfo':hi,'followinfo':fi})
#查看数据表的内容
house.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>totalprice</th>
      <th>houseinfo</th>
      <th>followinfo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1390</td>
      <td>阳光上东滨河花园 /2室1厅/190.65平米/南 北/简装/有电梯</td>
      <td>19人关注/15次带看VR房源房本满五年1390万单价72909元/平米</td>
    </tr>
    <tr>
      <th>1</th>
      <td>230</td>
      <td>住欣家园 /1室1厅/49.47平米/南/精装/有电梯</td>
      <td>62人关注/8次带看近地铁VR房源房本满五年230万单价46493元/平米</td>
    </tr>
    <tr>
      <th>2</th>
      <td>295</td>
      <td>建材城西二里 /1室1厅/46.3平米/东/简装/无电梯</td>
      <td>20人关注/4次带看近地铁VR房源房本满五年295万单价63715元/平米</td>
    </tr>
    <tr>
      <th>3</th>
      <td>599.9</td>
      <td>晨月园 /1室1厅/68.04平米/南/简装/有电梯</td>
      <td>37人关注/11次带看近地铁VR房源房本满五年随时看房599.9万单价88169元/平米</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1030</td>
      <td>新外大街甲25号院 /3室2厅/103平米/南 北/简装/有电梯</td>
      <td>26人关注/28次带看近地铁房本满两年1030万单价100000元/平米</td>
    </tr>
  </tbody>
</table>
</div>




```python
#对房源信息进行分列
houseinfo_split = pd.DataFrame((x.split('/') for x in house.houseinfo),index=house.index,columns=['小区','户型','面积','朝向','装修','电梯'])
```


```python
#查看分列结果
houseinfo_split.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>小区</th>
      <th>户型</th>
      <th>面积</th>
      <th>朝向</th>
      <th>装修</th>
      <th>电梯</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>阳光上东滨河花园</td>
      <td>2室1厅</td>
      <td>190.65平米</td>
      <td>南 北</td>
      <td>简装</td>
      <td>有电梯</td>
    </tr>
    <tr>
      <th>1</th>
      <td>住欣家园</td>
      <td>1室1厅</td>
      <td>49.47平米</td>
      <td>南</td>
      <td>精装</td>
      <td>有电梯</td>
    </tr>
    <tr>
      <th>2</th>
      <td>建材城西二里</td>
      <td>1室1厅</td>
      <td>46.3平米</td>
      <td>东</td>
      <td>简装</td>
      <td>无电梯</td>
    </tr>
    <tr>
      <th>3</th>
      <td>晨月园</td>
      <td>1室1厅</td>
      <td>68.04平米</td>
      <td>南</td>
      <td>简装</td>
      <td>有电梯</td>
    </tr>
    <tr>
      <th>4</th>
      <td>新外大街甲25号院</td>
      <td>3室2厅</td>
      <td>103平米</td>
      <td>南 北</td>
      <td>简装</td>
      <td>有电梯</td>
    </tr>
  </tbody>
</table>
</div>




```python
#将分列结果拼接回原数据表
house=pd.merge(house,houseinfo_split,right_index=True, left_index=True)
house.head()
```


```python
#对房源关注度进行分列
followinfo_split = pd.DataFrame((x.split('/') for x in house.followinfo),index=house.index,columns=['guanzhu','daikan','fabu'])
#将分列后的关注度信息拼接回原数据表
house=pd.merge(house,followinfo_split,right_index=True, left_index=True)
house.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>totalprice</th>
      <th>houseinfo</th>
      <th>followinfo</th>
      <th>小区</th>
      <th>户型</th>
      <th>面积</th>
      <th>朝向</th>
      <th>装修</th>
      <th>电梯</th>
      <th>guanzhu_x</th>
      <th>daikan_x</th>
      <th>fabu_x</th>
      <th>guanzhu_y</th>
      <th>daikan_y</th>
      <th>fabu_y</th>
      <th>guanzhu</th>
      <th>daikan</th>
      <th>fabu</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1390</td>
      <td>阳光上东滨河花园 /2室1厅/190.65平米/南 北/简装/有电梯</td>
      <td>19人关注/15次带看VR房源房本满五年1390万单价72909元/平米</td>
      <td>阳光上东滨河花园</td>
      <td>2室1厅</td>
      <td>190.65平米</td>
      <td>南 北</td>
      <td>简装</td>
      <td>有电梯</td>
      <td>19人关注</td>
      <td>15次带看VR房源房本满五年1390万单价72909元</td>
      <td>平米</td>
      <td>19人关注</td>
      <td>15次带看VR房源房本满五年1390万单价72909元</td>
      <td>平米</td>
      <td>19人关注</td>
      <td>15次带看VR房源房本满五年1390万单价72909元</td>
      <td>平米</td>
    </tr>
    <tr>
      <th>1</th>
      <td>230</td>
      <td>住欣家园 /1室1厅/49.47平米/南/精装/有电梯</td>
      <td>62人关注/8次带看近地铁VR房源房本满五年230万单价46493元/平米</td>
      <td>住欣家园</td>
      <td>1室1厅</td>
      <td>49.47平米</td>
      <td>南</td>
      <td>精装</td>
      <td>有电梯</td>
      <td>62人关注</td>
      <td>8次带看近地铁VR房源房本满五年230万单价46493元</td>
      <td>平米</td>
      <td>62人关注</td>
      <td>8次带看近地铁VR房源房本满五年230万单价46493元</td>
      <td>平米</td>
      <td>62人关注</td>
      <td>8次带看近地铁VR房源房本满五年230万单价46493元</td>
      <td>平米</td>
    </tr>
    <tr>
      <th>2</th>
      <td>295</td>
      <td>建材城西二里 /1室1厅/46.3平米/东/简装/无电梯</td>
      <td>20人关注/4次带看近地铁VR房源房本满五年295万单价63715元/平米</td>
      <td>建材城西二里</td>
      <td>1室1厅</td>
      <td>46.3平米</td>
      <td>东</td>
      <td>简装</td>
      <td>无电梯</td>
      <td>20人关注</td>
      <td>4次带看近地铁VR房源房本满五年295万单价63715元</td>
      <td>平米</td>
      <td>20人关注</td>
      <td>4次带看近地铁VR房源房本满五年295万单价63715元</td>
      <td>平米</td>
      <td>20人关注</td>
      <td>4次带看近地铁VR房源房本满五年295万单价63715元</td>
      <td>平米</td>
    </tr>
    <tr>
      <th>3</th>
      <td>599.9</td>
      <td>晨月园 /1室1厅/68.04平米/南/简装/有电梯</td>
      <td>37人关注/11次带看近地铁VR房源房本满五年随时看房599.9万单价88169元/平米</td>
      <td>晨月园</td>
      <td>1室1厅</td>
      <td>68.04平米</td>
      <td>南</td>
      <td>简装</td>
      <td>有电梯</td>
      <td>37人关注</td>
      <td>11次带看近地铁VR房源房本满五年随时看房599.9万单价88169元</td>
      <td>平米</td>
      <td>37人关注</td>
      <td>11次带看近地铁VR房源房本满五年随时看房599.9万单价88169元</td>
      <td>平米</td>
      <td>37人关注</td>
      <td>11次带看近地铁VR房源房本满五年随时看房599.9万单价88169元</td>
      <td>平米</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1030</td>
      <td>新外大街甲25号院 /3室2厅/103平米/南 北/简装/有电梯</td>
      <td>26人关注/28次带看近地铁房本满两年1030万单价100000元/平米</td>
      <td>新外大街甲25号院</td>
      <td>3室2厅</td>
      <td>103平米</td>
      <td>南 北</td>
      <td>简装</td>
      <td>有电梯</td>
      <td>26人关注</td>
      <td>28次带看近地铁房本满两年1030万单价100000元</td>
      <td>平米</td>
      <td>26人关注</td>
      <td>28次带看近地铁房本满两年1030万单价100000元</td>
      <td>平米</td>
      <td>26人关注</td>
      <td>28次带看近地铁房本满两年1030万单价100000元</td>
      <td>平米</td>
    </tr>
  </tbody>
</table>
</div>



> 参考：

1. [廖雪峰Python数据分析](https://www.julyedu.com/course/getDetail/66/)
